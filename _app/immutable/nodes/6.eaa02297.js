import{S as ut,i as pt,s as mt,k as o,a as E,y as ft,q as V,N as ht,l as c,m as d,h as s,c as x,z as vt,r as q,n as u,O as tt,E as r,b as A,A as _t,F as X,L as wt,g as gt,d as bt,B as yt,P as kt,o as Tt,T as St,w as Et}from"../chunks/index.32631a68.js";import{S as xt,r as jt}from"../chunks/SyntaxHighlight.3ff41aa2.js";import{i as It,g as Dt}from"../chunks/auth.1300090c.js";import{g as it}from"../chunks/navigation.80cc5101.js";const{document:B}=St;function Ot(w){let h,a,y,k,R,t,I,D,g,O,b,v,U,p,l,i,n,N,m,M,C,_,T,z,j,Y,S,P,J,Q,H,W,F,Z,et;return g=new xt({}),{c(){h=o("link"),a=o("script"),k=o("script"),t=o("script"),D=E(),ft(g.$$.fragment),O=E(),b=o("h1"),v=V("editor"),U=E(),p=o("div"),l=o("div"),i=o("button"),n=V("edit"),N=E(),m=o("button"),M=V("preview"),C=E(),_=o("div"),T=o("div"),z=E(),j=o("textarea"),Y=E(),S=o("div"),P=o("button"),J=V("cancel"),Q=E(),H=o("button"),W=V("save"),this.h()},l(e){const f=ht("svelte-10tpdyr",B.head);h=c(f,"LINK",{rel:!0,href:!0,integrity:!0,crossorigin:!0}),a=c(f,"SCRIPT",{src:!0});var ot=d(a);ot.forEach(s),k=c(f,"SCRIPT",{src:!0});var ct=d(k);ct.forEach(s),t=c(f,"SCRIPT",{src:!0});var dt=d(t);dt.forEach(s),f.forEach(s),D=x(e),vt(g.$$.fragment,e),O=x(e),b=c(e,"H1",{class:!0});var st=d(b);v=q(st,"editor"),st.forEach(s),U=x(e),p=c(e,"DIV",{class:!0});var L=d(p);l=c(L,"DIV",{class:!0});var K=d(l);i=c(K,"BUTTON",{});var rt=d(i);n=q(rt,"edit"),rt.forEach(s),N=x(K),m=c(K,"BUTTON",{});var lt=d(m);M=q(lt,"preview"),lt.forEach(s),K.forEach(s),C=x(L),_=c(L,"DIV",{class:!0});var $=d(_);T=c($,"DIV",{class:!0}),d(T).forEach(s),z=x($),j=c($,"TEXTAREA",{class:!0}),d(j).forEach(s),$.forEach(s),Y=x(L),S=c(L,"DIV",{class:!0});var G=d(S);P=c(G,"BUTTON",{});var nt=d(P);J=q(nt,"cancel"),nt.forEach(s),Q=x(G),H=c(G,"BUTTON",{});var at=d(H);W=q(at,"save"),at.forEach(s),G.forEach(s),L.forEach(s),this.h()},h(){u(h,"rel","stylesheet"),u(h,"href","https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"),u(h,"integrity","sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"),u(h,"crossorigin","anonymous"),tt(a.src,y="//cdn.jsdelivr.net/npm/marked/marked.min.js")||u(a,"src",y),tt(k.src,R="//cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js")||u(k,"src",R),tt(t.src,I="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js")||u(t,"src",I),u(b,"class","svelte-wwn397"),u(l,"class","markdown-header"),u(T,"class","preview"),j.value=w[1],u(j,"class","svelte-wwn397"),u(_,"class","markdown-body svelte-wwn397"),u(S,"class","markdown-footer"),u(p,"class","markdown-editor svelte-wwn397")},m(e,f){r(B.head,h),r(B.head,a),r(B.head,k),r(B.head,t),A(e,D,f),_t(g,e,f),A(e,O,f),A(e,b,f),r(b,v),A(e,U,f),A(e,p,f),r(p,l),r(l,i),r(i,n),r(l,N),r(l,m),r(m,M),r(p,C),r(p,_),r(_,T),r(_,z),r(_,j),w[6](j),r(p,Y),r(p,S),r(S,P),r(P,J),r(S,Q),r(S,H),r(H,W),F=!0,Z||(et=[X(i,"click",w[3]),X(m,"click",w[2]),X(P,"click",w[4]),X(H,"click",w[5])],Z=!0)},p:wt,i(e){F||(gt(g.$$.fragment,e),F=!0)},o(e){bt(g.$$.fragment,e),F=!1},d(e){s(h),s(a),s(k),s(t),e&&s(D),yt(g,e),e&&s(O),e&&s(b),e&&s(U),e&&s(p),w[6](null),Z=!1,kt(et)}}}function Ut(w,h,a){let y=new Date(Date.now());console.log(y.toString().split("GMT")[1].slice(3,5));let R=`---
title: 
tags: [ ]
date: ${`${y.toISOString().split("T")[0]} ${y.toString().split(" ")[4]} ${y.toString().split("GMT")[1].slice(0,3)}:${y.toString().split("GMT")[1].slice(3,5)}`}
visibility: public #private unlisted
---
`,t,I;function D(){const l=/^---[\s\S]*?---\s*/m,i=t.value.replace(l,""),n={throwOnError:!1},N={mangle:!1,headerIds:!1};marked.use(markedKatex(n),N);let m=marked.parse(i);console.log(m),a(0,t.style.display="none",t),I.innerHTML=m,jt()}function g(){a(0,t.style.display="block",t),I.innerHTML=""}function O(){it("/blog")}function b(){try{let l=t.value,i=l.split("---")[1],n=jsyaml.load(i);if(!["public","private","unlisted"].includes(n.visibility))throw new Error("visibillty should be either 'public', 'private', or 'unlisted'");let m={Id:v==null?null:v.Id,Title:n.title,Date:n.date,MarkDown:l,Tags:n.tags,Html:"",Url:"",Visibility:n.visibility};const M=/^---[\s\S]*?---\s*/m,C=t.value.replace(M,""),_={throwOnError:!1};marked.use(markedKatex(_)),m.Html=marked.parse(C),m.Url=`${n.date.toISOString().split("T")[0]}-${n.title.replaceAll(" ","-")}`;let T=Dt();const z=fetch("https://107106.xyz/blog/",{method:v==null?"POST":"PUT",body:JSON.stringify(m),headers:{"Content-Type":"application/json",Token:T??""}}).then(()=>{it("/blog")})}catch(l){window.alert(l.message)}}let v=null;async function U(){const i=new URL(window.location.href).searchParams.get("edit");i!=null&&(v=await fetch(`https://107106.xyz/blog/${i}`).then(n=>n.json()))}Tt(async()=>{await It()||(window.location.href="/admin"),await U(),a(0,t=document.querySelector("textarea")),I=document.querySelector(".preview"),t.addEventListener("keydown",l=>{if(l.key==="Tab"){const i=t.selectionStart,n=t.selectionEnd;a(0,t.value=t.value.substring(0,i)+"	"+t.value.substring(n),t),a(0,t.selectionStart=a(0,t.selectionEnd=i+1,t),t),l.preventDefault()}}),v!=null&&a(0,t.value=v.MarkDown,t)});function p(l){Et[l?"unshift":"push"](()=>{t=l,a(0,t)})}return[t,R,D,g,O,b,p]}class Mt extends ut{constructor(h){super(),pt(this,h,Ut,Ot,mt,{})}}export{Mt as component};
