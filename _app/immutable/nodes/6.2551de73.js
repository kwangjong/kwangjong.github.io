import{S as ut,i as pt,s as mt,k as o,a as S,y as ft,q as V,R as ht,l as c,m as d,h as s,c as E,z as vt,r as q,n as u,N as tt,E as r,b as R,A as _t,F as K,L as wt,g as yt,d as gt,B as bt,O as kt,T as Tt}from"../chunks/index.158cc983.js";import{S as St,r as Et}from"../chunks/SyntaxHighlight.96f282c6.js";import{g as xt,a as jt}from"../chunks/auth.3ff9f89f.js";import{g as it}from"../chunks/navigation.d561a5cd.js";const{document:$}=Tt;function It(_){let m,i,g,b,B,t,x,j,w,I,y,f,D,l,n,a,O,v,k,C,M,h,U,X,N,Y,T,H,J,Q,L,W,z,Z,et;return w=new St({}),{c(){m=o("link"),i=o("script"),b=o("script"),t=o("script"),j=S(),ft(w.$$.fragment),I=S(),y=o("h1"),f=V("editor"),D=S(),l=o("div"),n=o("div"),a=o("button"),O=V("edit"),v=S(),k=o("button"),C=V("preview"),M=S(),h=o("div"),U=o("div"),X=S(),N=o("textarea"),Y=S(),T=o("div"),H=o("button"),J=V("cancel"),Q=S(),L=o("button"),W=V("save"),this.h()},l(e){const p=ht("svelte-10tpdyr",$.head);m=c(p,"LINK",{rel:!0,href:!0,integrity:!0,crossorigin:!0}),i=c(p,"SCRIPT",{src:!0});var ot=d(i);ot.forEach(s),b=c(p,"SCRIPT",{src:!0});var ct=d(b);ct.forEach(s),t=c(p,"SCRIPT",{src:!0});var dt=d(t);dt.forEach(s),p.forEach(s),j=E(e),vt(w.$$.fragment,e),I=E(e),y=c(e,"H1",{class:!0});var st=d(y);f=q(st,"editor"),st.forEach(s),D=E(e),l=c(e,"DIV",{class:!0});var P=d(l);n=c(P,"DIV",{class:!0});var A=d(n);a=c(A,"BUTTON",{});var rt=d(a);O=q(rt,"edit"),rt.forEach(s),v=E(A),k=c(A,"BUTTON",{});var lt=d(k);C=q(lt,"preview"),lt.forEach(s),A.forEach(s),M=E(P),h=c(P,"DIV",{class:!0});var F=d(h);U=c(F,"DIV",{class:!0}),d(U).forEach(s),X=E(F),N=c(F,"TEXTAREA",{class:!0}),d(N).forEach(s),F.forEach(s),Y=E(P),T=c(P,"DIV",{class:!0});var G=d(T);H=c(G,"BUTTON",{});var at=d(H);J=q(at,"cancel"),at.forEach(s),Q=E(G),L=c(G,"BUTTON",{});var nt=d(L);W=q(nt,"save"),nt.forEach(s),G.forEach(s),P.forEach(s),this.h()},h(){u(m,"rel","stylesheet"),u(m,"href","https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"),u(m,"integrity","sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"),u(m,"crossorigin","anonymous"),tt(i.src,g="//cdn.jsdelivr.net/npm/marked/marked.min.js")||u(i,"src",g),tt(b.src,B="//cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js")||u(b,"src",B),tt(t.src,x="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js")||u(t,"src",x),u(y,"class","svelte-wwn397"),u(n,"class","markdown-header"),u(U,"class","preview"),N.value=_[0],u(N,"class","svelte-wwn397"),u(h,"class","markdown-body svelte-wwn397"),u(T,"class","markdown-footer"),u(l,"class","markdown-editor svelte-wwn397")},m(e,p){r($.head,m),r($.head,i),r($.head,b),r($.head,t),R(e,j,p),_t(w,e,p),R(e,I,p),R(e,y,p),r(y,f),R(e,D,p),R(e,l,p),r(l,n),r(n,a),r(a,O),r(n,v),r(n,k),r(k,C),r(l,M),r(l,h),r(h,U),r(h,X),r(h,N),r(l,Y),r(l,T),r(T,H),r(H,J),r(T,Q),r(T,L),r(L,W),z=!0,Z||(et=[K(a,"click",_[2]),K(k,"click",_[1]),K(H,"click",_[3]),K(L,"click",_[4])],Z=!0)},p:wt,i(e){z||(yt(w.$$.fragment,e),z=!0)},o(e){gt(w.$$.fragment,e),z=!1},d(e){s(m),s(i),s(b),s(t),e&&s(j),bt(w,e),e&&s(I),e&&s(y),e&&s(D),e&&s(l),Z=!1,kt(et)}}}function Dt(_,m,i){let g=new Date(Date.now());console.log(g.toString().split("GMT")[1].slice(3,5));let B=`---
title: 
tags: [ ]
date: ${`${g.toISOString().split("T")[0]} ${g.toString().split(" ")[4]} ${g.toString().split("GMT")[1].slice(0,3)}:${g.toString().split("GMT")[1].slice(3,5)}`}
visibility: public #private unlisted
---
`,t,x;function j(){const l=/^---[\s\S]*?---\s*/m,n=t.value.replace(l,""),a={throwOnError:!1},O={mangle:!1,headerIds:!1};marked.use(markedKatex(a),O);let v=marked.parse(n);console.log(v),i(5,t.style.display="none",t),x.innerHTML=v,Et()}function w(){i(5,t.style.display="block",t),x.innerHTML=""}function I(){it("/blog")}function y(){try{let l=t.value,n=l.split("---")[1],a=jsyaml.load(n);if(!["public","private","unlisted"].includes(a.visibility))throw new Error("visibillty should be either 'public', 'private', or 'unlisted'");let v={Id:f==null?null:f.Id,Title:a.title,Date:a.date,MarkDown:l,Tags:a.tags,Html:"",Url:"",Visibility:a.visibility};const k=/^---[\s\S]*?---\s*/m,C=t.value.replace(k,""),M={throwOnError:!1};marked.use(markedKatex(M)),v.Html=marked.parse(C),v.Url=`${a.date.toISOString().split("T")[0]}-${a.title.replaceAll(" ","-")}`;let h=xt();const U=fetch("https://107106.xyz/blog/",{method:f==null?"POST":"PUT",body:JSON.stringify(v),headers:{"Content-Type":"application/json",Token:h??""}}).then(()=>{it("/blog")})}catch(l){window.alert(l.message)}}let f=null;async function D(){await jt();const n=new URL(window.location.href).searchParams.get("edit");n!=null&&i(6,f=await fetch(`https://107106.xyz/blog/${n}`).then(a=>a.json()))}return _.$$.update=()=>{_.$$.dirty&96&&(async()=>(await D(),i(5,t=document.querySelector("textarea")),x=document.querySelector(".preview"),t.addEventListener("keydown",l=>{if(l.key==="Tab"){const n=t.selectionStart,a=t.selectionEnd;i(5,t.value=t.value.substring(0,n)+"	"+t.value.substring(a),t),i(5,t.selectionStart=i(5,t.selectionEnd=n+1,t),t),l.preventDefault()}}),f!=null&&i(5,t.value=f.MarkDown,t)))()},[B,j,w,I,y,t,f]}class Lt extends ut{constructor(m){super(),pt(this,m,Dt,It,mt,{})}}export{Lt as component};
