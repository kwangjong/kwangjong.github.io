import{S as pe,i as me,s as fe,k as o,a as q,y as ve,q as H,O as he,l as c,m as d,h as r,c as D,z as _e,r as L,n as a,P as ee,E as l,b as V,A as we,F as X,M as ge,g as be,d as ye,B as ke,J as Te,o as Ee,U as Se,w as ie}from"../chunks/index.c5363583.js";import{S as Ie,r as xe}from"../chunks/SyntaxHighlight.9002b25e.js";import{i as je,g as qe}from"../chunks/auth.59faee21.js";import{g as oe}from"../chunks/navigation.4051e2e4.js";import{B as De}from"../chunks/config.356a930e.js";const{document:K}=Se;function Oe(f){let v,n,E,S,R,e,h,U,k,N,T,_,A,u,w,t,p,i,g,b,B,y,I,C,x,Y,j,O,Q,W,P,Z,F,$,te;return k=new Ie({}),{c(){v=o("link"),n=o("script"),S=o("script"),e=o("script"),U=q(),ve(k.$$.fragment),N=q(),T=o("h1"),_=H("editor"),A=q(),u=o("div"),w=o("div"),t=o("button"),p=H("edit"),i=q(),g=o("button"),b=H("preview"),B=q(),y=o("div"),I=o("div"),C=q(),x=o("textarea"),Y=q(),j=o("div"),O=o("button"),Q=H("cancel"),W=q(),P=o("button"),Z=H("save"),this.h()},l(s){const m=he("svelte-10tpdyr",K.head);v=c(m,"LINK",{rel:!0,href:!0,integrity:!0,crossorigin:!0}),n=c(m,"SCRIPT",{src:!0});var ce=d(n);ce.forEach(r),S=c(m,"SCRIPT",{src:!0});var de=d(S);de.forEach(r),e=c(m,"SCRIPT",{src:!0});var ue=d(e);ue.forEach(r),m.forEach(r),U=D(s),_e(k.$$.fragment,s),N=D(s),T=c(s,"H1",{class:!0});var se=d(T);_=L(se,"editor"),se.forEach(r),A=D(s),u=c(s,"DIV",{class:!0});var M=d(u);w=c(M,"DIV",{class:!0});var G=d(w);t=c(G,"BUTTON",{class:!0});var re=d(t);p=L(re,"edit"),re.forEach(r),i=D(G),g=c(G,"BUTTON",{class:!0});var le=d(g);b=L(le,"preview"),le.forEach(r),G.forEach(r),B=D(M),y=c(M,"DIV",{class:!0});var z=d(y);I=c(z,"DIV",{class:!0}),d(I).forEach(r),C=D(z),x=c(z,"TEXTAREA",{class:!0}),d(x).forEach(r),z.forEach(r),Y=D(M),j=c(M,"DIV",{class:!0});var J=d(j);O=c(J,"BUTTON",{class:!0});var ne=d(O);Q=L(ne,"cancel"),ne.forEach(r),W=D(J),P=c(J,"BUTTON",{class:!0});var ae=d(P);Z=L(ae,"save"),ae.forEach(r),J.forEach(r),M.forEach(r),this.h()},h(){a(v,"rel","stylesheet"),a(v,"href","https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"),a(v,"integrity","sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"),a(v,"crossorigin","anonymous"),ee(n.src,E="//cdn.jsdelivr.net/npm/marked/marked.min.js")||a(n,"src",E),ee(S.src,R="//cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js")||a(S,"src",R),ee(e.src,h="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js")||a(e,"src",h),a(T,"class","svelte-17vwqr1"),a(t,"class","svelte-17vwqr1"),a(g,"class","svelte-17vwqr1"),a(w,"class","markdown-header"),a(I,"class","preview"),x.value=f[2],a(x,"class","svelte-17vwqr1"),a(y,"class","markdown-body svelte-17vwqr1"),a(O,"class","svelte-17vwqr1"),a(P,"class","svelte-17vwqr1"),a(j,"class","markdown-footer"),a(u,"class","markdown-editor svelte-17vwqr1")},m(s,m){l(K.head,v),l(K.head,n),l(K.head,S),l(K.head,e),V(s,U,m),we(k,s,m),V(s,N,m),V(s,T,m),l(T,_),V(s,A,m),V(s,u,m),l(u,w),l(w,t),l(t,p),l(w,i),l(w,g),l(g,b),l(u,B),l(u,y),l(y,I),f[7](I),l(y,C),l(y,x),f[8](x),l(u,Y),l(u,j),l(j,O),l(O,Q),l(j,W),l(j,P),l(P,Z),F=!0,$||(te=[X(t,"click",f[4]),X(g,"click",f[3]),X(O,"click",f[5]),X(P,"click",f[6])],$=!0)},p:ge,i(s){F||(be(k.$$.fragment,s),F=!0)},o(s){ye(k.$$.fragment,s),F=!1},d(s){r(v),r(n),r(S),r(e),s&&r(U),ke(k,s),s&&r(N),s&&r(T),s&&r(A),s&&r(u),f[7](null),f[8](null),$=!1,Te(te)}}}function Pe(f,v,n){let E=new Date(Date.now());console.log(E.toString().split("GMT")[1].slice(3,5));let R=`---
title: 
tags: [ ]
date: ${`${E.toISOString().split("T")[0]} ${E.toString().split(" ")[4]} ${E.toString().split("GMT")[1].slice(0,3)}:${E.toString().split("GMT")[1].slice(3,5)}`}
visibility: public #private unlisted
---
`,e,h;function U(){const t=/^---[\s\S]*?---\s*/m,p=e.value.replace(t,""),i={throwOnError:!1},g={mangle:!1,headerIds:!1};marked.use(markedKatex(i),g);let b=marked.parse(p);console.log(b),n(0,e.style.display="none",e),n(1,h.innerHTML=b,h),xe()}function k(){n(0,e.style.display="block",e),n(1,h.innerHTML="",h)}function N(){oe("/blog")}function T(){try{let t=e.value,p=t.split("---")[1],i=jsyaml.load(p);if(!["public","private","unlisted"].includes(i.visibility))throw new Error("visibillty should be either 'public', 'private', or 'unlisted'");let b={Id:_==null?null:_.Id,Title:i.title,Date:i.date,MarkDown:t,Tags:i.tags,Html:"",Url:"",Visibility:i.visibility};const B=/^---[\s\S]*?---\s*/m,y=e.value.replace(B,""),I={throwOnError:!1};marked.use(markedKatex(I)),b.Html=marked.parse(y),b.Url=`${i.date.toISOString().split("T")[0]}-${i.title.replaceAll(" ","-")}`;let C=qe();const x=fetch("${BACKEND_API}/blog/",{method:_==null?"POST":"PUT",body:JSON.stringify(b),headers:{"Content-Type":"application/json",Token:C??""}}).then(()=>{oe("/blog")})}catch(t){window.alert(t.message)}}let _=null;async function A(){const p=new URL(window.location.href).searchParams.get("edit");p!=null&&(_=await fetch(`${De}/blog/${p}`).then(i=>i.json()))}Ee(async()=>{await je()||(window.location.href="/admin"),await A(),n(0,e=document.querySelector("textarea")),n(1,h=document.querySelector(".preview")),e.addEventListener("keydown",t=>{if(t.key==="Tab"){const p=e.selectionStart,i=e.selectionEnd;n(0,e.value=e.value.substring(0,p)+"	"+e.value.substring(i),e),n(0,e.selectionStart=n(0,e.selectionEnd=p+1,e),e),t.preventDefault()}}),_!=null&&n(0,e.value=_.MarkDown,e)});function u(t){ie[t?"unshift":"push"](()=>{h=t,n(1,h)})}function w(t){ie[t?"unshift":"push"](()=>{e=t,n(0,e)})}return[e,h,R,U,k,N,T,u,w]}class Be extends pe{constructor(v){super(),me(this,v,Pe,Oe,fe,{})}}export{Be as component};
