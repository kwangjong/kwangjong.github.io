import{S as fe,i as he,s as ve,k as o,a as q,y as _e,q as B,O as we,l as c,m as d,h as r,c as D,z as ge,r as L,n as a,P as ee,E as l,b as V,A as be,F as X,M as ye,g as ke,d as Te,B as Ee,J as Se,o as xe,U as Ie,w as ie}from"../chunks/index.c5363583.js";import{S as je,r as qe}from"../chunks/SyntaxHighlight.56d04d61.js";import{i as De,g as oe}from"../chunks/auth.3fa1d903.js";import{g as ce}from"../chunks/navigation.95042f5f.js";import{B as de}from"../chunks/config.5be6a1b9.js";const{document:K}=Ie;function Oe(h){let v,n,E,S,R,e,_,P,k,M,T,w,N,u,g,t,p,i,m,b,A,y,x,C,I,Y,j,O,Q,W,U,Z,F,$,te;return k=new je({}),{c(){v=o("link"),n=o("script"),S=o("script"),e=o("script"),P=q(),_e(k.$$.fragment),M=q(),T=o("h1"),w=B("editor"),N=q(),u=o("div"),g=o("div"),t=o("button"),p=B("edit"),i=q(),m=o("button"),b=B("preview"),A=q(),y=o("div"),x=o("div"),C=q(),I=o("textarea"),Y=q(),j=o("div"),O=o("button"),Q=B("cancel"),W=q(),U=o("button"),Z=B("save"),this.h()},l(s){const f=we("svelte-10tpdyr",K.head);v=c(f,"LINK",{rel:!0,href:!0,integrity:!0,crossorigin:!0}),n=c(f,"SCRIPT",{src:!0});var ue=d(n);ue.forEach(r),S=c(f,"SCRIPT",{src:!0});var pe=d(S);pe.forEach(r),e=c(f,"SCRIPT",{src:!0});var me=d(e);me.forEach(r),f.forEach(r),P=D(s),ge(k.$$.fragment,s),M=D(s),T=c(s,"H1",{class:!0});var se=d(T);w=L(se,"editor"),se.forEach(r),N=D(s),u=c(s,"DIV",{class:!0});var H=d(u);g=c(H,"DIV",{class:!0});var G=d(g);t=c(G,"BUTTON",{class:!0});var re=d(t);p=L(re,"edit"),re.forEach(r),i=D(G),m=c(G,"BUTTON",{class:!0});var le=d(m);b=L(le,"preview"),le.forEach(r),G.forEach(r),A=D(H),y=c(H,"DIV",{class:!0});var z=d(y);x=c(z,"DIV",{class:!0}),d(x).forEach(r),C=D(z),I=c(z,"TEXTAREA",{class:!0}),d(I).forEach(r),z.forEach(r),Y=D(H),j=c(H,"DIV",{class:!0});var J=d(j);O=c(J,"BUTTON",{class:!0});var ne=d(O);Q=L(ne,"cancel"),ne.forEach(r),W=D(J),U=c(J,"BUTTON",{class:!0});var ae=d(U);Z=L(ae,"save"),ae.forEach(r),J.forEach(r),H.forEach(r),this.h()},h(){a(v,"rel","stylesheet"),a(v,"href","https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"),a(v,"integrity","sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"),a(v,"crossorigin","anonymous"),ee(n.src,E="//cdn.jsdelivr.net/npm/marked/marked.min.js")||a(n,"src",E),ee(S.src,R="//cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js")||a(S,"src",R),ee(e.src,_="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js")||a(e,"src",_),a(T,"class","svelte-17vwqr1"),a(t,"class","svelte-17vwqr1"),a(m,"class","svelte-17vwqr1"),a(g,"class","markdown-header"),a(x,"class","preview"),I.value=h[2],a(I,"class","svelte-17vwqr1"),a(y,"class","markdown-body svelte-17vwqr1"),a(O,"class","svelte-17vwqr1"),a(U,"class","svelte-17vwqr1"),a(j,"class","markdown-footer"),a(u,"class","markdown-editor svelte-17vwqr1")},m(s,f){l(K.head,v),l(K.head,n),l(K.head,S),l(K.head,e),V(s,P,f),be(k,s,f),V(s,M,f),V(s,T,f),l(T,w),V(s,N,f),V(s,u,f),l(u,g),l(g,t),l(t,p),l(g,i),l(g,m),l(m,b),l(u,A),l(u,y),l(y,x),h[7](x),l(y,C),l(y,I),h[8](I),l(u,Y),l(u,j),l(j,O),l(O,Q),l(j,W),l(j,U),l(U,Z),F=!0,$||(te=[X(t,"click",h[4]),X(m,"click",h[3]),X(O,"click",h[5]),X(U,"click",h[6])],$=!0)},p:ye,i(s){F||(ke(k.$$.fragment,s),F=!0)},o(s){Te(k.$$.fragment,s),F=!1},d(s){r(v),r(n),r(S),r(e),s&&r(P),Ee(k,s),s&&r(M),s&&r(T),s&&r(N),s&&r(u),h[7](null),h[8](null),$=!1,Se(te)}}}function Ue(h,v,n){let E=new Date(Date.now());console.log(E.toString().split("GMT")[1].slice(3,5));let R=`---
title: 
tags: [ ]
date: ${`${E.toISOString().split("T")[0]} ${E.toString().split(" ")[4]} ${E.toString().split("GMT")[1].slice(0,3)}:${E.toString().split("GMT")[1].slice(3,5)}`}
visibility: public #private unlisted
---
`,e,_;function P(){const t=/^---[\s\S]*?---\s*/m,p=e.value.replace(t,""),i={throwOnError:!1},m={mangle:!1,headerIds:!1};marked.use(markedKatex(i),m);let b=marked.parse(p);console.log(b),n(0,e.style.display="none",e),n(1,_.innerHTML=b,_),qe()}function k(){n(0,e.style.display="block",e),n(1,_.innerHTML="",_)}function M(){ce("/blog")}function T(){try{let t=e.value,p=t.split("---")[1],i=jsyaml.load(p);if(!["public","private","unlisted"].includes(i.visibility))throw new Error("visibillty should be either 'public', 'private', or 'unlisted'");let b={Id:w==null?null:w.Id,Title:i.title,Date:i.date,MarkDown:t,Tags:i.tags,Html:"",Url:"",Visibility:i.visibility};const A=/^---[\s\S]*?---\s*/m,y=e.value.replace(A,""),x={throwOnError:!1};marked.use(markedKatex(x)),b.Html=marked.parse(y),b.Url=`${i.date.toISOString().split("T")[0]}-${i.title.replaceAll(" ","-")}`;let C=oe();const I=fetch(`${de}/blog/new`,{method:w==null?"POST":"PUT",body:JSON.stringify(b),headers:{"Content-Type":"application/json",Token:C??""}}).then(()=>{ce("/blog")})}catch(t){window.alert(t.message)}}let w=null;async function N(){const p=new URL(window.location.href).searchParams.get("edit");let i=oe();w=await fetch(`${de}/blog/${p}`,{method:"GET",headers:{Token:i||""}}).then(m=>m.json())}xe(async()=>{await De()||(window.location.href="/admin"),await N(),n(0,e=document.querySelector("textarea")),n(1,_=document.querySelector(".preview")),e.addEventListener("keydown",t=>{if(t.key==="Tab"){const p=e.selectionStart,i=e.selectionEnd;n(0,e.value=e.value.substring(0,p)+"	"+e.value.substring(i),e),n(0,e.selectionStart=n(0,e.selectionEnd=p+1,e),e),t.preventDefault()}}),w!=null&&n(0,e.value=w.MarkDown,e)});function u(t){ie[t?"unshift":"push"](()=>{_=t,n(1,_)})}function g(t){ie[t?"unshift":"push"](()=>{e=t,n(0,e)})}return[e,_,R,P,k,M,T,u,g]}class Ae extends fe{constructor(v){super(),he(this,v,Ue,Oe,ve,{})}}export{Ae as component};
