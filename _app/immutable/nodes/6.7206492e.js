import{S as ut,i as pt,s as mt,k as n,a as T,y as vt,q as M,R as ft,l as i,m as d,h as s,c as S,z as ht,r as P,n as u,N as tt,E as r,b as C,A as _t,F as K,L as wt,g as yt,d as gt,B as bt,O as kt,o as Tt,T as St}from"../chunks/index.158cc983.js";import{S as Et,r as xt}from"../chunks/SyntaxHighlight.96f282c6.js";import{g as $t,a as jt}from"../chunks/auth.3ff9f89f.js";import{g as it}from"../chunks/navigation.8b72cfdb.js";const{document:V}=St;function It(E){let l,y,q,a,x,h,R,$,_,v,w,o,c,t,f,p,N,H,g,j,B,b,L,X,I,Y,k,D,J,Q,O,W,z,Z,et;return _=new Et({}),{c(){l=n("link"),y=n("script"),a=n("script"),h=n("script"),$=T(),vt(_.$$.fragment),v=T(),w=n("h1"),o=M("editor"),c=T(),t=n("div"),f=n("div"),p=n("button"),N=M("edit"),H=T(),g=n("button"),j=M("preview"),B=T(),b=n("div"),L=n("div"),X=T(),I=n("textarea"),Y=T(),k=n("div"),D=n("button"),J=M("cancel"),Q=T(),O=n("button"),W=M("save"),this.h()},l(e){const m=ft("svelte-10tpdyr",V.head);l=i(m,"LINK",{rel:!0,href:!0,integrity:!0,crossorigin:!0}),y=i(m,"SCRIPT",{src:!0});var ot=d(y);ot.forEach(s),a=i(m,"SCRIPT",{src:!0});var ct=d(a);ct.forEach(s),h=i(m,"SCRIPT",{src:!0});var dt=d(h);dt.forEach(s),m.forEach(s),$=S(e),ht(_.$$.fragment,e),v=S(e),w=i(e,"H1",{class:!0});var st=d(w);o=P(st,"editor"),st.forEach(s),c=S(e),t=i(e,"DIV",{class:!0});var U=d(t);f=i(U,"DIV",{class:!0});var A=d(f);p=i(A,"BUTTON",{});var at=d(p);N=P(at,"edit"),at.forEach(s),H=S(A),g=i(A,"BUTTON",{});var rt=d(g);j=P(rt,"preview"),rt.forEach(s),A.forEach(s),B=S(U),b=i(U,"DIV",{class:!0});var F=d(b);L=i(F,"DIV",{class:!0}),d(L).forEach(s),X=S(F),I=i(F,"TEXTAREA",{class:!0}),d(I).forEach(s),F.forEach(s),Y=S(U),k=i(U,"DIV",{class:!0});var G=d(k);D=i(G,"BUTTON",{});var lt=d(D);J=P(lt,"cancel"),lt.forEach(s),Q=S(G),O=i(G,"BUTTON",{});var nt=d(O);W=P(nt,"save"),nt.forEach(s),G.forEach(s),U.forEach(s),this.h()},h(){u(l,"rel","stylesheet"),u(l,"href","https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"),u(l,"integrity","sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"),u(l,"crossorigin","anonymous"),tt(y.src,q="//cdn.jsdelivr.net/npm/marked/marked.min.js")||u(y,"src",q),tt(a.src,x="//cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js")||u(a,"src",x),tt(h.src,R="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js")||u(h,"src",R),u(w,"class","svelte-wwn397"),u(f,"class","markdown-header"),u(L,"class","preview"),I.value=E[0],u(I,"class","svelte-wwn397"),u(b,"class","markdown-body svelte-wwn397"),u(k,"class","markdown-footer"),u(t,"class","markdown-editor svelte-wwn397")},m(e,m){r(V.head,l),r(V.head,y),r(V.head,a),r(V.head,h),C(e,$,m),_t(_,e,m),C(e,v,m),C(e,w,m),r(w,o),C(e,c,m),C(e,t,m),r(t,f),r(f,p),r(p,N),r(f,H),r(f,g),r(g,j),r(t,B),r(t,b),r(b,L),r(b,X),r(b,I),r(t,Y),r(t,k),r(k,D),r(D,J),r(k,Q),r(k,O),r(O,W),z=!0,Z||(et=[K(p,"click",E[2]),K(g,"click",E[1]),K(D,"click",E[3]),K(O,"click",E[4])],Z=!0)},p:wt,i(e){z||(yt(_.$$.fragment,e),z=!0)},o(e){gt(_.$$.fragment,e),z=!1},d(e){s(l),s(y),s(a),s(h),e&&s($),bt(_,e),e&&s(v),e&&s(w),e&&s(c),e&&s(t),Z=!1,kt(et)}}}function Dt(E){let l=new Date(Date.now());console.log(l.toString().split("GMT")[1].slice(3,5));let q=`---
title: 
tags: [ ]
date: ${`${l.toISOString().split("T")[0]} ${l.toString().split(" ")[4]} ${l.toString().split("GMT")[1].slice(0,3)}:${l.toString().split("GMT")[1].slice(3,5)}`}
visibility: public #private unlisted
---
`,a,x;function h(){const o=/^---[\s\S]*?---\s*/m,c=a.value.replace(o,""),t={throwOnError:!1},f={mangle:!1,headerIds:!1};marked.use(markedKatex(t),f);let p=marked.parse(c);console.log(p),a.style.display="none",x.innerHTML=p,xt()}function R(){a.style.display="block",x.innerHTML=""}function $(){it("/blog")}function _(){try{let o=a.value,c=o.split("---")[1],t=jsyaml.load(c);if(!["public","private","unlisted"].includes(t.visibility))throw new Error("visibillty should be either 'public', 'private', or 'unlisted'");let p={Id:v==null?null:v.Id,Title:t.title,Date:t.date,MarkDown:o,Tags:t.tags,Html:"",Url:"",Visibility:t.visibility};const N=/^---[\s\S]*?---\s*/m,H=a.value.replace(N,""),g={throwOnError:!1};marked.use(markedKatex(g)),p.Html=marked.parse(H),p.Url=`${t.date.toISOString().split("T")[0]}-${t.title.replaceAll(" ","-")}`;let j=$t();const B=fetch("https://107106.xyz/blog/",{method:v==null?"POST":"PUT",body:JSON.stringify(p),headers:{"Content-Type":"application/json",Token:j??""}}).then(()=>{it("/blog")})}catch(o){window.alert(o.message)}}let v=null;async function w(){await jt();const c=new URL(window.location.href).searchParams.get("edit");c!=null&&(v=await fetch(`https://107106.xyz/blog/${c}`).then(t=>t.json()))}return Tt(async()=>{await w(),a=document.querySelector("textarea"),x=document.querySelector(".preview"),a.addEventListener("keydown",o=>{if(o.key==="Tab"){const c=a.selectionStart,t=a.selectionEnd;a.value=a.value.substring(0,c)+"	"+a.value.substring(t),a.selectionStart=a.selectionEnd=c+1,o.preventDefault()}}),v!=null&&(a.value=v.MarkDown)}),[q,h,R,$,_]}class Lt extends ut{constructor(l){super(),pt(this,l,Dt,It,mt,{})}}export{Lt as component};
