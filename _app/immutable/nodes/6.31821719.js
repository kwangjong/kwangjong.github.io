import{S as pt,i as mt,s as ft,k as i,a as D,y as ht,q,N as _t,l as o,m as c,h as s,c as O,z as vt,r as A,n as d,O as tt,E as n,b as B,A as wt,F as Y,L as gt,g as bt,d as yt,B as kt,P as Tt,o as St,T as Et,w as it}from"../chunks/index.32631a68.js";import{S as xt,r as jt}from"../chunks/SyntaxHighlight.3ff41aa2.js";import{i as It,g as Dt}from"../chunks/auth.050595b4.js";import{g as ot}from"../chunks/navigation.90bd916f.js";const{document:R}=Et;function Ot(f){let h,l,S,E,z,t,_,U,y,N,k,v,P,u,w,r,p,a,T,g,V,b,x,H,j,J,I,L,Q,W,M,Z,F,$,et;return y=new xt({}),{c(){h=i("link"),l=i("script"),E=i("script"),t=i("script"),U=D(),ht(y.$$.fragment),N=D(),k=i("h1"),v=q("editor"),P=D(),u=i("div"),w=i("div"),r=i("button"),p=q("edit"),a=D(),T=i("button"),g=q("preview"),V=D(),b=i("div"),x=i("div"),H=D(),j=i("textarea"),J=D(),I=i("div"),L=i("button"),Q=q("cancel"),W=D(),M=i("button"),Z=q("save"),this.h()},l(e){const m=_t("svelte-10tpdyr",R.head);h=o(m,"LINK",{rel:!0,href:!0,integrity:!0,crossorigin:!0}),l=o(m,"SCRIPT",{src:!0});var ct=c(l);ct.forEach(s),E=o(m,"SCRIPT",{src:!0});var dt=c(E);dt.forEach(s),t=o(m,"SCRIPT",{src:!0});var ut=c(t);ut.forEach(s),m.forEach(s),U=O(e),vt(y.$$.fragment,e),N=O(e),k=o(e,"H1",{class:!0});var st=c(k);v=A(st,"editor"),st.forEach(s),P=O(e),u=o(e,"DIV",{class:!0});var C=c(u);w=o(C,"DIV",{class:!0});var K=c(w);r=o(K,"BUTTON",{});var rt=c(r);p=A(rt,"edit"),rt.forEach(s),a=O(K),T=o(K,"BUTTON",{});var nt=c(T);g=A(nt,"preview"),nt.forEach(s),K.forEach(s),V=O(C),b=o(C,"DIV",{class:!0});var G=c(b);x=o(G,"DIV",{class:!0}),c(x).forEach(s),H=O(G),j=o(G,"TEXTAREA",{class:!0}),c(j).forEach(s),G.forEach(s),J=O(C),I=o(C,"DIV",{class:!0});var X=c(I);L=o(X,"BUTTON",{});var lt=c(L);Q=A(lt,"cancel"),lt.forEach(s),W=O(X),M=o(X,"BUTTON",{});var at=c(M);Z=A(at,"save"),at.forEach(s),X.forEach(s),C.forEach(s),this.h()},h(){d(h,"rel","stylesheet"),d(h,"href","https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"),d(h,"integrity","sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"),d(h,"crossorigin","anonymous"),tt(l.src,S="//cdn.jsdelivr.net/npm/marked/marked.min.js")||d(l,"src",S),tt(E.src,z="//cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js")||d(E,"src",z),tt(t.src,_="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js")||d(t,"src",_),d(k,"class","svelte-wwn397"),d(w,"class","markdown-header"),d(x,"class","preview"),j.value=f[2],d(j,"class","svelte-wwn397"),d(b,"class","markdown-body svelte-wwn397"),d(I,"class","markdown-footer"),d(u,"class","markdown-editor svelte-wwn397")},m(e,m){n(R.head,h),n(R.head,l),n(R.head,E),n(R.head,t),B(e,U,m),wt(y,e,m),B(e,N,m),B(e,k,m),n(k,v),B(e,P,m),B(e,u,m),n(u,w),n(w,r),n(r,p),n(w,a),n(w,T),n(T,g),n(u,V),n(u,b),n(b,x),f[7](x),n(b,H),n(b,j),f[8](j),n(u,J),n(u,I),n(I,L),n(L,Q),n(I,W),n(I,M),n(M,Z),F=!0,$||(et=[Y(r,"click",f[4]),Y(T,"click",f[3]),Y(L,"click",f[5]),Y(M,"click",f[6])],$=!0)},p:gt,i(e){F||(bt(y.$$.fragment,e),F=!0)},o(e){yt(y.$$.fragment,e),F=!1},d(e){s(h),s(l),s(E),s(t),e&&s(U),kt(y,e),e&&s(N),e&&s(k),e&&s(P),e&&s(u),f[7](null),f[8](null),$=!1,Tt(et)}}}function Ut(f,h,l){let S=new Date(Date.now());console.log(S.toString().split("GMT")[1].slice(3,5));let z=`---
title: 
tags: [ ]
date: ${`${S.toISOString().split("T")[0]} ${S.toString().split(" ")[4]} ${S.toString().split("GMT")[1].slice(0,3)}:${S.toString().split("GMT")[1].slice(3,5)}`}
visibility: public #private unlisted
---
`,t,_;function U(){const r=/^---[\s\S]*?---\s*/m,p=t.value.replace(r,""),a={throwOnError:!1},T={mangle:!1,headerIds:!1};marked.use(markedKatex(a),T);let g=marked.parse(p);console.log(g),l(0,t.style.display="none",t),l(1,_.innerHTML=g,_),jt()}function y(){l(0,t.style.display="block",t),l(1,_.innerHTML="",_)}function N(){ot("/blog")}function k(){try{let r=t.value,p=r.split("---")[1],a=jsyaml.load(p);if(!["public","private","unlisted"].includes(a.visibility))throw new Error("visibillty should be either 'public', 'private', or 'unlisted'");let g={Id:v==null?null:v.Id,Title:a.title,Date:a.date,MarkDown:r,Tags:a.tags,Html:"",Url:"",Visibility:a.visibility};const V=/^---[\s\S]*?---\s*/m,b=t.value.replace(V,""),x={throwOnError:!1};marked.use(markedKatex(x)),g.Html=marked.parse(b),g.Url=`${a.date.toISOString().split("T")[0]}-${a.title.replaceAll(" ","-")}`;let H=Dt();const j=fetch("https://107106.xyz/blog/",{method:v==null?"POST":"PUT",body:JSON.stringify(g),headers:{"Content-Type":"application/json",Token:H??""}}).then(()=>{ot("/blog")})}catch(r){window.alert(r.message)}}let v=null;async function P(){const p=new URL(window.location.href).searchParams.get("edit");p!=null&&(v=await fetch(`https://107106.xyz/blog/${p}`).then(a=>a.json()))}St(async()=>{await It()||(window.location.href="/admin"),await P(),l(0,t=document.querySelector("textarea")),l(1,_=document.querySelector(".preview")),t.addEventListener("keydown",r=>{if(r.key==="Tab"){const p=t.selectionStart,a=t.selectionEnd;l(0,t.value=t.value.substring(0,p)+"	"+t.value.substring(a),t),l(0,t.selectionStart=l(0,t.selectionEnd=p+1,t),t),r.preventDefault()}}),v!=null&&l(0,t.value=v.MarkDown,t)});function u(r){it[r?"unshift":"push"](()=>{_=r,l(1,_)})}function w(r){it[r?"unshift":"push"](()=>{t=r,l(0,t)})}return[t,_,z,U,y,N,k,u,w]}class Mt extends pt{constructor(h){super(),mt(this,h,Ut,Ot,ft,{})}}export{Mt as component};
