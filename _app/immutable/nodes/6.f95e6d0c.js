import{S as pt,i as mt,s as ft,k as i,a as D,y as ht,q as L,O as _t,l as o,m as c,h as s,c as O,z as vt,r as V,n as d,P as tt,E as n,b as q,A as wt,F as X,M as gt,g as bt,d as yt,B as kt,J as Tt,o as Et,T as St,w as it}from"../chunks/index.dec1645f.js";import{S as It,r as xt}from"../chunks/SyntaxHighlight.809c8298.js";import{i as jt,g as Dt}from"../chunks/auth.59faee21.js";import{g as ot}from"../chunks/navigation.96128ac4.js";import{B as Ot}from"../chunks/config.356a930e.js";const{document:K}=St;function Pt(f){let h,l,E,S,R,t,_,P,y,N,k,v,U,u,w,r,p,a,T,g,H,b,I,A,x,Y,j,C,Q,W,M,Z,F,$,et;return y=new It({}),{c(){h=i("link"),l=i("script"),S=i("script"),t=i("script"),P=D(),ht(y.$$.fragment),N=D(),k=i("h1"),v=L("editor"),U=D(),u=i("div"),w=i("div"),r=i("button"),p=L("edit"),a=D(),T=i("button"),g=L("preview"),H=D(),b=i("div"),I=i("div"),A=D(),x=i("textarea"),Y=D(),j=i("div"),C=i("button"),Q=L("cancel"),W=D(),M=i("button"),Z=L("save"),this.h()},l(e){const m=_t("svelte-10tpdyr",K.head);h=o(m,"LINK",{rel:!0,href:!0,integrity:!0,crossorigin:!0}),l=o(m,"SCRIPT",{src:!0});var ct=c(l);ct.forEach(s),S=o(m,"SCRIPT",{src:!0});var dt=c(S);dt.forEach(s),t=o(m,"SCRIPT",{src:!0});var ut=c(t);ut.forEach(s),m.forEach(s),P=O(e),vt(y.$$.fragment,e),N=O(e),k=o(e,"H1",{class:!0});var st=c(k);v=V(st,"editor"),st.forEach(s),U=O(e),u=o(e,"DIV",{class:!0});var B=c(u);w=o(B,"DIV",{class:!0});var G=c(w);r=o(G,"BUTTON",{});var rt=c(r);p=V(rt,"edit"),rt.forEach(s),a=O(G),T=o(G,"BUTTON",{});var nt=c(T);g=V(nt,"preview"),nt.forEach(s),G.forEach(s),H=O(B),b=o(B,"DIV",{class:!0});var z=c(b);I=o(z,"DIV",{class:!0}),c(I).forEach(s),A=O(z),x=o(z,"TEXTAREA",{class:!0}),c(x).forEach(s),z.forEach(s),Y=O(B),j=o(B,"DIV",{class:!0});var J=c(j);C=o(J,"BUTTON",{});var lt=c(C);Q=V(lt,"cancel"),lt.forEach(s),W=O(J),M=o(J,"BUTTON",{});var at=c(M);Z=V(at,"save"),at.forEach(s),J.forEach(s),B.forEach(s),this.h()},h(){d(h,"rel","stylesheet"),d(h,"href","https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"),d(h,"integrity","sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"),d(h,"crossorigin","anonymous"),tt(l.src,E="//cdn.jsdelivr.net/npm/marked/marked.min.js")||d(l,"src",E),tt(S.src,R="//cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js")||d(S,"src",R),tt(t.src,_="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js")||d(t,"src",_),d(k,"class","svelte-wwn397"),d(w,"class","markdown-header"),d(I,"class","preview"),x.value=f[2],d(x,"class","svelte-wwn397"),d(b,"class","markdown-body svelte-wwn397"),d(j,"class","markdown-footer"),d(u,"class","markdown-editor svelte-wwn397")},m(e,m){n(K.head,h),n(K.head,l),n(K.head,S),n(K.head,t),q(e,P,m),wt(y,e,m),q(e,N,m),q(e,k,m),n(k,v),q(e,U,m),q(e,u,m),n(u,w),n(w,r),n(r,p),n(w,a),n(w,T),n(T,g),n(u,H),n(u,b),n(b,I),f[7](I),n(b,A),n(b,x),f[8](x),n(u,Y),n(u,j),n(j,C),n(C,Q),n(j,W),n(j,M),n(M,Z),F=!0,$||(et=[X(r,"click",f[4]),X(T,"click",f[3]),X(C,"click",f[5]),X(M,"click",f[6])],$=!0)},p:gt,i(e){F||(bt(y.$$.fragment,e),F=!0)},o(e){yt(y.$$.fragment,e),F=!1},d(e){s(h),s(l),s(S),s(t),e&&s(P),kt(y,e),e&&s(N),e&&s(k),e&&s(U),e&&s(u),f[7](null),f[8](null),$=!1,Tt(et)}}}function Nt(f,h,l){let E=new Date(Date.now());console.log(E.toString().split("GMT")[1].slice(3,5));let R=`---
title: 
tags: [ ]
date: ${`${E.toISOString().split("T")[0]} ${E.toString().split(" ")[4]} ${E.toString().split("GMT")[1].slice(0,3)}:${E.toString().split("GMT")[1].slice(3,5)}`}
visibility: public #private unlisted
---
`,t,_;function P(){const r=/^---[\s\S]*?---\s*/m,p=t.value.replace(r,""),a={throwOnError:!1},T={mangle:!1,headerIds:!1};marked.use(markedKatex(a),T);let g=marked.parse(p);console.log(g),l(0,t.style.display="none",t),l(1,_.innerHTML=g,_),xt()}function y(){l(0,t.style.display="block",t),l(1,_.innerHTML="",_)}function N(){ot("/blog")}function k(){try{let r=t.value,p=r.split("---")[1],a=jsyaml.load(p);if(!["public","private","unlisted"].includes(a.visibility))throw new Error("visibillty should be either 'public', 'private', or 'unlisted'");let g={Id:v==null?null:v.Id,Title:a.title,Date:a.date,MarkDown:r,Tags:a.tags,Html:"",Url:"",Visibility:a.visibility};const H=/^---[\s\S]*?---\s*/m,b=t.value.replace(H,""),I={throwOnError:!1};marked.use(markedKatex(I)),g.Html=marked.parse(b),g.Url=`${a.date.toISOString().split("T")[0]}-${a.title.replaceAll(" ","-")}`;let A=Dt();const x=fetch("${BACKEND_API}/blog/",{method:v==null?"POST":"PUT",body:JSON.stringify(g),headers:{"Content-Type":"application/json",Token:A??""}}).then(()=>{ot("/blog")})}catch(r){window.alert(r.message)}}let v=null;async function U(){const p=new URL(window.location.href).searchParams.get("edit");p!=null&&(v=await fetch(`${Ot}/blog/${p}`).then(a=>a.json()))}Et(async()=>{await jt()||(window.location.href="/admin"),await U(),l(0,t=document.querySelector("textarea")),l(1,_=document.querySelector(".preview")),t.addEventListener("keydown",r=>{if(r.key==="Tab"){const p=t.selectionStart,a=t.selectionEnd;l(0,t.value=t.value.substring(0,p)+"	"+t.value.substring(a),t),l(0,t.selectionStart=l(0,t.selectionEnd=p+1,t),t),r.preventDefault()}}),v!=null&&l(0,t.value=v.MarkDown,t)});function u(r){it[r?"unshift":"push"](()=>{_=r,l(1,_)})}function w(r){it[r?"unshift":"push"](()=>{t=r,l(0,t)})}return[t,_,R,P,y,N,k,u,w]}class Ht extends pt{constructor(h){super(),mt(this,h,Nt,Pt,ft,{})}}export{Ht as component};
